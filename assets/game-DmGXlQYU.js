(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();function y(r){try{if(!Array.isArray(r))throw new Error("O par√¢metro fornecido n√£o √© um array.");const e=[...r];for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}return e}catch(e){return console.error("Erro ao embaralhar array:",e),r}}function z(r){try{return r?r.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>"):""}catch(e){return console.error("Erro ao converter Markdown Simples:",e),r||""}}function w(r,e){try{r.opcoes.filter(i=>i.correta).length>=1?e.push(r):console.warn(`Pergunta ID: ${r.id} descartada: Nenhuma op√ß√£o correta definida.`)}catch(t){console.error("Erro na valida√ß√£o da pergunta:",t,r)}}function E(r){try{if(typeof r!="string")throw new Error("A entrada do quiz deve ser uma string Markdown.");const e=r.replace(/\r\n/g,`
`).split(`
`);let t={titulo:"",descricao:"",perguntas:[]},i="",n=!1,s="Geral",l=null,d=null;return e.forEach((u,f)=>{try{const c=u.trim();if(c.startsWith("```md")){n=!0;return}if(c.startsWith("```")&&n){n=!1;return}if(n){i+=u+`
`;return}if(!c)return;if(c.startsWith("# ")){t.titulo=c.replace("# ","").trim();return}if(c.startsWith("## "))return;const m=c.match(/^__(.*?)__$/);if(m&&m[1]!==void 0){s=m[1].trim();return}if(c.startsWith("id:")){l&&w(l,t.perguntas),l={id:c.replace("id:","").trim(),categoria:s,enunciado:"",opcoes:[],dica:null};return}if(c.startsWith("### ")){l&&(l.enunciado=c.replace("### ","").trim());return}if(c.startsWith("[ ]")||c.startsWith("[x]")){if(l){const T=c.startsWith("[x]");d={texto:c.replace(/\[(x| )\]/,"").trim(),correta:T,explicacao:null},l.opcoes.push(d)}return}if((c.startsWith("-!")||c.startsWith("-["))&&d){d.explicacao=c.replace(/^(-!|-\[|\])/g,"").trim();return}if(c.startsWith("-#")&&l){l.dica=c.replace("-#","").trim();return}}catch(c){console.error(`Erro ao processar a linha ${f+1}: "${u}"`,c)}}),l&&w(l,t.perguntas),t.descricao=z(i),t}catch(e){return console.error("Falha cr√≠tica no parseMarkdownQuiz:",e),{titulo:"Erro no carregamento",descricao:"",perguntas:[]}}}function R(r,e){try{const t=E(r);return!t||!t.perguntas?[]:t.perguntas.map(i=>({...i,id:`${e.replace(".md","")}-${i.id}`}))}catch(t){return console.error(`Erro em extrairPerguntasMass (Arquivo: ${e}):`,t),[]}}const h="quizSRSData";function $(){try{const r=localStorage.getItem(h);return r?JSON.parse(r):{}}catch(r){return console.error("Erro ao ler SRS do LocalStorage (Dados corrompidos?):",r),{}}}function b(r){try{const e=JSON.stringify(r);localStorage.setItem(h,e)}catch(e){console.error("Erro ao salvar SRS no LocalStorage:",e),e.name==="QuotaExceededError"&&console.warn("Aviso: LocalStorage est√° cheio. O progresso pode n√£o ser salvo.")}}function A(){try{confirm("Tem certeza? Isso apagar√° todo o hist√≥rico de aprendizado do Modo Treino.")&&(localStorage.removeItem(h),alert("Mem√≥ria limpa! O algoritmo recome√ßar√° do zero."),location.reload())}catch(r){console.error("Erro ao resetar mem√≥ria SRS:",r),alert("N√£o foi poss√≠vel limpar os dados. Tente limpar o cache do navegador.")}}function I(r,e,t){try{if(!r)throw new Error("ID da quest√£o n√£o fornecido.");const i=$();let n=i[r]||{lastReviewed:0,interval:0,ef:2.5,reps:0},s=0;e?t<10?s=5:t<20?s=4:t<30?s=3:s=2:s=0;let l=n.ef+(.1-(5-s)*(.08+(5-s)*.02));l<1.3&&(l=1.3);let d=1,u=n.reps;s<3?(u=0,d=1):(u++,u===1?d=1:u===2?d=6:d=Math.round(n.interval*l)),i[r]={lastReviewed:Date.now(),interval:d,ef:parseFloat(l.toFixed(2)),reps:u},b(i)}catch(i){console.error(`Erro cr√≠tico ao processar algoritmo SRS para ID ${r}:`,i)}}const g=r=>{try{return`/quiz-biblico//${r}`.replace(/\/+/g,"/")}catch(e){return console.error("Erro ao resolver caminho de asset:",e),r}},p=r=>{const e=document.getElementById(r);return e||console.warn(`Elemento cr√≠tico n√£o encontrado no DOM: #${r}`),e},a={lista:p("lista-quizes"),stage:p("quiz-stage"),progresso:p("barra-progresso-container"),titulo:p("titulo-quiz"),descricao:p("descricao-quiz"),tempo:p("display-tempo"),contador:p("contador-perguntas"),selecao:p("tela-selecao"),confete:p("canvas-confete")},o={perguntas:[],indiceAtual:0,acertos:0,pontuacaoTotal:0,modoJogo:null,respondido:!1,dicasRestantes:2,tempoTotal:30,tempoRestante:30,timerInterval:null,srsStartTime:0};window.iniciarJogo=r=>S(r);window.iniciarModoTreino=()=>L();window.verificarResposta=(r,e)=>q(r,e);window.mostrarDica=(r,e)=>mostrarDicaInternal(r,e);window.transicaoProximaPergunta=()=>J();window.resetarMemoriaSRS=A;function M(){try{console.log("üïπÔ∏è Inicializando Engine do Jogo..."),D(),P()}catch(r){console.error("Falha cr√≠tica na inicializa√ß√£o:",r)}}function D(){if(!a.lista)return;const r=g("quizes/index.json");fetch(r).then(e=>{if(!e.ok)throw new Error(`Falha ao carregar index.json (Status: ${e.status})`);return e.json()}).then(e=>{a.lista.innerHTML=e.map(t=>`<li><a href="quiz.html?id=${t.arquivo}">${t.titulo}</a></li>`).join("")}).catch(e=>{console.error("Erro na lista de quizes:",e),a.lista.innerHTML=`<div class="error-msg">‚ö†Ô∏è Erro ao carregar quizes: ${e.message}</div>`})}function P(){if(!a.stage)return;const e=new URLSearchParams(window.location.search).get("id");if(e){const t=g(`quizes/${e}.md`);fetch(t).then(i=>{if(!i.ok)throw new Error(`Arquivo de quiz "${e}.md" n√£o encontrado em ${t}`);return i.text()}).then(i=>{const n=E(i);if(!n||!n.perguntas.length)throw new Error("O arquivo Markdown est√° vazio ou mal formatado.");a.titulo&&(a.titulo.innerText=n.titulo||"Quiz"),a.descricao&&n.descricao&&(a.descricao.innerHTML=n.descricao,a.descricao.style.display="block"),o.perguntas=n.perguntas,a.selecao&&(a.selecao.style.display="flex"),a.stage&&(a.stage.style.display="none")}).catch(i=>{console.error("Erro ao processar quiz da URL:",i),v(`Erro no carregamento: ${i.message}`)})}}async function L(){try{a.titulo&&(a.titulo.innerText="Carregando Mem√≥ria..."),a.selecao&&(a.selecao.style.display="none");const r=await fetch(g("quizes/index.json"));if(!r.ok)throw new Error("N√£o foi poss√≠vel acessar a lista de quizes para o treino.");const e=await r.json();let t=[];const i=e.map(async f=>{try{const c=await fetch(g(`quizes/${f.arquivo}.md?t=${Date.now()}`));if(!c.ok)throw new Error(`Arquivo ${f.arquivo}.md falhou.`);const m=await c.text();return R(m,f.arquivo)}catch(c){return console.warn(`Pulando arquivo ${f.arquivo} devido a erro:`,c),[]}});(await Promise.all(i)).forEach(f=>t.push(...f));const s=$(),l=Date.now(),d=864e5,u=t.filter(f=>{const c=s[f.id];return c?l>=c.lastReviewed+c.interval*d:!0});if(u.length===0){alert("üéâ Tudo em dia! Voc√™ revisou todo o conte√∫do pendente."),window.location.href="index.html";return}o.perguntas=y(u).slice(0,50),S("treino")}catch(r){console.error("ERRO CR√çTICO NO MODO TREINO:",r),alert(`Erro ao iniciar treino: ${r.message}`),location.reload()}}function S(r){try{if(!o.perguntas.length)throw new Error("Nenhuma pergunta carregada no estado.");o.modoJogo=r,o.indiceAtual=0,o.acertos=0,o.pontuacaoTotal=0,o.dicasRestantes=2,o.tempoTotal=r==="desafio"?15:30,window.pontuacaoTotal=0,window.modoJogo=r,a.selecao&&(a.selecao.style.display="none"),a.descricao&&(a.descricao.style.display="none"),a.stage&&(a.stage.style.display="grid"),r!=="treino"&&(a.progresso&&(a.progresso.style.display="flex"),a.tempo&&(a.tempo.style.display="block"),a.contador&&(a.contador.style.display="block"),renderizarBarraProgresso()),x(o.perguntas[0])}catch(e){console.error("Erro ao iniciar partida:",e),v(`N√£o foi poss√≠vel iniciar o jogo: ${e.message}`)}}function x(r){try{if(!r)throw new Error("Pergunta inv√°lida ou inexistente.");o.respondido=!1,o.srsStartTime=Date.now(),a.contador&&(a.contador.innerText=`${o.indiceAtual+1} / ${o.perguntas.length}`),a.titulo&&o.modoJogo==="treino"&&(a.titulo.innerText=`üß† Treino (${o.indiceAtual+1}/${o.perguntas.length})`);const e=y([...r.opcoes]),t=document.createElement("div");t.className="card-quiz ativo",t.innerHTML=`
      <div class="categoria-label">${r.categoria||"Geral"}</div>
      <div class="pergunta">${r.enunciado}</div>
      <div class="lista-opcoes">
          ${e.map((i,n)=>`
              <div class="opcao-wrapper">
                  <div class="opcao" data-is-correct="${i.correta}" onclick="window.verificarResposta(${n}, this)">
                      ${i.texto}
                  </div>
              </div>`).join("")}
      </div>
      <div class="area-dica-container">
          ${r.dica?`<button class="btn-dica-minimal" onclick="window.mostrarDica(this, '${r.dica.replace(/'/g,"\\'")}')">üí° Dica</button>`:""}
          <div class="texto-dica-placeholder"></div>
      </div>
      <button id="btn-prox" style="display:none;" onclick="window.transicaoProximaPergunta()">Pr√≥xima Quest√£o ‚ûú</button>
    `,a.stage&&(a.stage.innerHTML="",a.stage.appendChild(t)),o.modoJogo!=="treino"&&(O(),animarBarraAtual())}catch(e){console.error("Erro ao renderizar pergunta:",e),v(`Erro visual: ${e.message}`)}}function v(r){a.stage&&(a.stage.innerHTML=`
      <div class="card-quiz ativo error-border">
        <h3>‚ùå Algo deu errado</h3>
        <p>${r}</p>
        <button onclick="location.href='index.html'">Voltar ao In√≠cio</button>
      </div>`,a.stage.style.display="block")}function q(r,e){try{if(o.respondido)return;o.respondido=!0,clearInterval(o.timerInterval);const t=(Date.now()-o.srsStartTime)/1e3,i=document.querySelector(".card-quiz.ativo");if(!i)throw new Error("Card ativo n√£o encontrado para validar resposta.");const n=i.querySelectorAll(".opcao");let s=!1;if(n.forEach(d=>{d.classList.add("bloqueado"),d.getAttribute("data-is-correct")==="true"?(d.classList.add("correta"),d===e&&(s=!0)):d===e&&d.classList.add("errada")}),o.modoJogo==="treino")I(o.perguntas[o.indiceAtual].id,s,t);else{if(s){o.acertos++;let d=o.modoJogo==="desafio"?15:10;o.pontuacaoTotal+=d+Math.round(d*(o.tempoRestante/o.tempoTotal))}if(o.modoJogo==="normal"){const d=document.getElementById(`seg-${o.indiceAtual}`);d&&d.classList.add(s?"correto":"errado")}if(o.modoJogo==="desafio"&&!s){setTimeout(()=>gameOverDesafio("Voc√™ Errou!"),600);return}}const l=i.querySelector("#btn-prox");l&&(l.style.display="block")}catch(t){console.error("Erro na verifica√ß√£o de resposta:",t)}}function O(){try{if(clearInterval(o.timerInterval),!a.tempo)return;o.tempoRestante=o.tempoTotal,a.tempo.innerText=`‚è±Ô∏è ${o.tempoRestante}s`,o.timerInterval=setInterval(()=>{o.tempoRestante--,a.tempo&&(a.tempo.innerText=`‚è±Ô∏è ${o.tempoRestante}s`),o.tempoRestante<=0&&(clearInterval(o.timerInterval),o.modoJogo==="desafio"?gameOverDesafio("Tempo Esgotado!"):q(-1,null))},1e3)}catch(r){console.error("Erro no Timer:",r)}}function J(){try{o.indiceAtual++,o.indiceAtual>=o.perguntas.length?o.modoJogo==="treino"?mostrarFimTreino():mostrarResultadoFinal():x(o.perguntas[o.indiceAtual])}catch(r){console.error("Erro na transi√ß√£o:",r)}}M();
