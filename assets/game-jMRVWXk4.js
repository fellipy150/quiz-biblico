(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function a(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=a(i);fetch(i.href,s)}})();function w(e){try{if(!Array.isArray(e))throw new Error("O par√¢metro fornecido n√£o √© um array.");const r=[...e];for(let a=r.length-1;a>0;a--){const n=Math.floor(Math.random()*(a+1));[r[a],r[n]]=[r[n],r[a]]}return r}catch(r){return console.error("Erro ao embaralhar array:",r),e}}function z(e){try{return e?e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>"):""}catch(r){return console.error("Erro ao converter Markdown Simples:",r),e||""}}function v(e,r){try{e.opcoes.filter(n=>n.correta).length>=1?r.push(e):console.warn(`Pergunta ID: ${e.id} descartada: Nenhuma op√ß√£o correta definida.`)}catch(a){console.error("Erro na valida√ß√£o da pergunta:",a,e)}}function x(e){try{if(typeof e!="string")throw new Error("A entrada do quiz deve ser uma string Markdown.");const r=e.replace(/\r\n/g,`
`).split(`
`);let a={titulo:"",descricao:"",perguntas:[]},n="",i=!1,s="Geral",d=null,c=null;return r.forEach((u,f)=>{try{const l=u.trim();if(l.startsWith("```md")){i=!0;return}if(l.startsWith("```")&&i){i=!1;return}if(i){n+=u+`
`;return}if(!l)return;if(l.startsWith("# ")){a.titulo=l.replace("# ","").trim();return}if(l.startsWith("## "))return;const m=l.match(/^__(.*?)__$/);if(m&&m[1]!==void 0){s=m[1].trim();return}if(l.startsWith("id:")){d&&v(d,a.perguntas),d={id:l.replace("id:","").trim(),categoria:s,enunciado:"",opcoes:[],dica:null};return}if(l.startsWith("### ")){d&&(d.enunciado=l.replace("### ","").trim());return}if(l.startsWith("[ ]")||l.startsWith("[x]")){if(d){const M=l.startsWith("[x]");c={texto:l.replace(/\[(x| )\]/,"").trim(),correta:M,explicacao:null},d.opcoes.push(c)}return}if((l.startsWith("-!")||l.startsWith("-["))&&c){c.explicacao=l.replace(/^(-!|-\[|\])/g,"").trim();return}if(l.startsWith("-#")&&d){d.dica=l.replace("-#","").trim();return}}catch(l){console.error(`Erro ao processar a linha ${f+1}: "${u}"`,l)}}),d&&v(d,a.perguntas),a.descricao=z(n),a}catch(r){return console.error("Falha cr√≠tica no parseMarkdownQuiz:",r),{titulo:"Erro no carregamento",descricao:"",perguntas:[]}}}function E(e,r){try{const a=x(e);return!a||!a.perguntas?[]:a.perguntas.map(n=>({...n,id:`${r.replace(".md","")}-${n.id}`}))}catch(a){return console.error(`Erro em extrairPerguntasMass (Arquivo: ${r}):`,a),[]}}const h="quizSRSData";function b(){try{const e=localStorage.getItem(h);return e?JSON.parse(e):{}}catch(e){return console.error("Erro ao ler SRS do LocalStorage (Dados corrompidos?):",e),{}}}function L(e){try{const r=JSON.stringify(e);localStorage.setItem(h,r)}catch(r){console.error("Erro ao salvar SRS no LocalStorage:",r),r.name==="QuotaExceededError"&&console.warn("Aviso: LocalStorage est√° cheio. O progresso pode n√£o ser salvo.")}}function R(){try{confirm("Tem certeza? Isso apagar√° todo o hist√≥rico de aprendizado do Modo Treino.")&&(localStorage.removeItem(h),alert("Mem√≥ria limpa! O algoritmo recome√ßar√° do zero."),location.reload())}catch(e){console.error("Erro ao resetar mem√≥ria SRS:",e),alert("N√£o foi poss√≠vel limpar os dados. Tente limpar o cache do navegador.")}}function A(e,r,a){try{if(!e)throw new Error("ID da quest√£o n√£o fornecido.");const n=b();let i=n[e]||{lastReviewed:0,interval:0,ef:2.5,reps:0},s=0;r?a<10?s=5:a<20?s=4:a<30?s=3:s=2:s=0;let d=i.ef+(.1-(5-s)*(.08+(5-s)*.02));d<1.3&&(d=1.3);let c=1,u=i.reps;s<3?(u=0,c=1):(u++,u===1?c=1:u===2?c=6:c=Math.round(i.interval*d)),n[e]={lastReviewed:Date.now(),interval:c,ef:parseFloat(d.toFixed(2)),reps:u},L(n)}catch(n){console.error(`Erro cr√≠tico ao processar algoritmo SRS para ID ${e}:`,n)}}const g=e=>{try{return`/quiz-biblico//${e}`.replace(/\/+/g,"/")}catch{return e}},p=e=>document.getElementById(e),t={lista:p("lista-quizes"),stage:p("quiz-stage"),progresso:p("barra-progresso-container"),titulo:p("titulo-quiz"),descricao:p("descricao-quiz"),tempo:p("display-tempo"),contador:p("contador-perguntas"),selecao:p("tela-selecao"),confete:p("canvas-confete")},o={perguntas:[],indiceAtual:0,acertos:0,pontuacaoTotal:0,modoJogo:null,respondido:!1,dicasRestantes:2,tempoTotal:30,tempoRestante:30,timerInterval:null,srsStartTime:0,animandoTroca:!1};window.iniciarJogo=e=>T(e);window.iniciarModoTreino=()=>J();window.verificarResposta=(e,r)=>$(e,r);window.mostrarDica=(e,r)=>O(e,r);window.transicaoProximaPergunta=()=>k();window.resetarMemoriaSRS=R;window.enviarPontuacao=j;function I(){P(),D()}function P(){t.lista&&fetch(g("quizes/index.json")).then(e=>e.ok?e.json():[]).then(e=>{e.length&&(t.lista.innerHTML=e.map(r=>`<li><a href="quiz.html?id=${r.arquivo}">${r.titulo}</a></li>`).join(""))}).catch(console.error)}function D(){if(!t.stage)return;const r=new URLSearchParams(window.location.search).get("id");r&&fetch(g(`quizes/${r}.md`)).then(a=>{if(!a.ok)throw new Error("Quiz n√£o encontrado");return a.text()}).then(a=>{const n=x(a);t.titulo&&(t.titulo.innerText=n.titulo||"Quiz"),t.descricao&&n.descricao&&(t.descricao.innerHTML=n.descricao,t.descricao.style.display="block"),o.perguntas=n.perguntas,t.selecao&&(t.selecao.style.display="flex"),t.stage&&(t.stage.style.display="none")}).catch(a=>{console.error(a),t.titulo&&(t.titulo.innerText="Erro ao carregar"),t.stage.innerHTML='<div class="card-quiz error">Erro ao carregar quiz. Verifique a URL e o formato do arquivo.</div>',t.stage.style.display="block"})}async function J(){t.titulo&&(t.titulo.innerText="Carregando Mem√≥ria..."),t.lista&&(t.lista.style.display="none"),t.selecao&&(t.selecao.style.display="none");try{const r=await(await fetch(g("quizes/index.json"))).json();let a=[];const n=r.map(async f=>{try{const l=await fetch(g(`quizes/${f.arquivo}.md?t=${Date.now()}`));if(!l.ok)return[];const m=await l.text();return E(m,f.arquivo)}catch{return[]}});(await Promise.all(n)).forEach(f=>a.push(...f));const s=b(),d=Date.now(),c=864e5,u=a.filter(f=>{const l=s[f.id];return l?d>=l.lastReviewed+l.interval*c:!0});if(u.length===0){alert("üéâ Tudo em dia! Voc√™ revisou todo o conte√∫do pendente."),window.location.href="index.html";return}o.perguntas=w(u).slice(0,50),t.titulo&&(t.titulo.innerText=`üß† Treino do Dia (${o.perguntas.length})`),T("treino")}catch(e){console.error(e),alert("Erro ao iniciar treino."),location.reload()}}function T(e){o.modoJogo=e,o.indiceAtual=0,o.acertos=0,o.pontuacaoTotal=0,o.dicasRestantes=2,o.tempoTotal=e==="desafio"?15:30,o.animandoTroca=!1,window.pontuacaoTotal=0,window.modoJogo=e,e==="desafio"?document.body.classList.add("modo-desafio"):document.body.classList.remove("modo-desafio"),t.selecao&&(t.selecao.style.display="none"),t.descricao&&(t.descricao.style.display="none"),t.titulo&&(t.titulo.style.display="block"),t.stage&&(t.stage.style.display="grid"),e!=="treino"?(t.progresso&&(t.progresso.style.display="flex"),t.tempo&&(t.tempo.style.display="block"),t.contador&&(t.contador.style.display="block"),H()):(t.progresso&&(t.progresso.style.display="none"),t.tempo&&(t.tempo.style.display="none"),t.contador&&(t.contador.style.display="none")),o.perguntas.length>0?S(o.perguntas[0],!1):alert("Nenhuma pergunta encontrada.")}function H(){t.progresso&&(t.progresso.innerHTML="",o.modoJogo==="desafio"?t.progresso.innerHTML='<div class="segmento-barra" id="seg-unico" style="flex: 1;"><div class="fill-tempo"></div></div>':t.progresso.innerHTML=o.perguntas.map((e,r)=>`<div class="segmento-barra" id="seg-${r}"><div class="fill-tempo"></div></div>`).join(""))}function S(e,r=!0){o.respondido=!1,o.srsStartTime=Date.now(),o.animandoTroca=!1,t.contador&&(t.contador.innerText=`${o.indiceAtual+1} / ${o.perguntas.length}`);const a=w([...e.opcoes]),n=document.createElement("div");if(n.className="card-quiz",n.innerHTML=`
    <div style="font-size:0.65rem; text-transform:uppercase; opacity:0.5; margin-bottom:4px; font-weight:800; letter-spacing:1px; text-align:center;">
        ${e.categoria||"Geral"}
    </div>
    <div class="pergunta">${e.enunciado}</div>
    <div class="lista-opcoes">
        ${a.map((i,s)=>`
            <div class="opcao-wrapper">
                <div class="opcao" data-is-correct="${i.correta}" onclick="window.verificarResposta(${s}, this)">
                    ${i.texto}
                </div>
            </div>`).join("")}
    </div>
    <div class="area-dica-container">
        ${e.dica?`<button class="btn-dica-minimal" onclick="window.mostrarDica(this, '${e.dica.replace(/'/g,"\\'")}')">üí° Dica</button>`:""}
        <div class="texto-dica-placeholder"></div>
    </div>
    <button id="btn-prox" style="display:none; margin-top:15px; width:100%; padding:12px;" onclick="window.transicaoProximaPergunta()">Pr√≥xima Quest√£o ‚ûú</button>
  `,r&&t.stage){n.classList.add("pre-render-direita");const i=t.stage.querySelector(".card-quiz.ativo");t.stage.appendChild(n),n.offsetWidth,i&&(i.classList.replace("ativo","saindo-esquerda"),setTimeout(()=>i.remove(),500)),n.classList.replace("pre-render-direita","ativo")}else n.classList.add("ativo"),t.stage.innerHTML="",t.stage.appendChild(n);o.modoJogo!=="treino"&&(C(),W())}function W(){const e=o.modoJogo==="desafio"?"seg-unico":`seg-${o.indiceAtual}`,r=document.getElementById(e);if(!r)return;r.classList.remove("correto","errado");const a=r.querySelector(".fill-tempo");a&&(a.style.transition="none",a.style.width="0%",a.offsetWidth,a.style.transition=`width ${o.tempoTotal}s linear`,a.style.width="100%")}function C(){t.tempo&&(o.tempoRestante=o.tempoTotal,clearInterval(o.timerInterval),t.tempo.innerText=`‚è±Ô∏è ${o.tempoRestante}s`,o.timerInterval=setInterval(()=>{o.tempoRestante--,t.tempo.innerText=`‚è±Ô∏è ${o.tempoRestante}s`,o.tempoRestante<=0&&(clearInterval(o.timerInterval),o.modoJogo==="desafio"?q("Tempo Esgotado!"):$(-1,null))},1e3))}function $(e,r){if(o.respondido)return;const a=(Date.now()-o.srsStartTime)/1e3;if(o.respondido=!0,clearInterval(o.timerInterval),o.modoJogo!=="treino"){const c=o.modoJogo==="desafio"?"seg-unico":`seg-${o.indiceAtual}`,u=document.getElementById(c);if(u){const f=u.querySelector(".fill-tempo");f&&(f.style.width=window.getComputedStyle(f).width,f.style.transition="none")}}const n=document.querySelector(".card-quiz.ativo");if(!n)return;const i=n.querySelectorAll(".opcao");let s=!1;if(i.forEach(c=>{c.classList.add("bloqueado"),c.getAttribute("data-is-correct")==="true"?(c.classList.add("correta"),c===r&&(s=!0)):c===r&&c.classList.add("errada")}),o.modoJogo==="treino"){const c=o.perguntas[o.indiceAtual];A(c.id,s,a)}else{if(s){o.acertos++;let c=o.modoJogo==="desafio"?15:10;o.pontuacaoTotal+=c+Math.round(c*(o.tempoRestante/o.tempoTotal))}if(window.pontuacaoTotal=o.pontuacaoTotal,o.modoJogo==="normal"){const c=document.getElementById(`seg-${o.indiceAtual}`);c&&c.classList.add(s?"correto":"errado")}if(o.modoJogo==="desafio"&&!s){setTimeout(()=>q("Voc√™ Errou!"),1e3);return}}const d=n.querySelector("#btn-prox");d&&(d.style.display="block")}function O(e,r){if(o.dicasRestantes<=0)return;o.dicasRestantes--,e.disabled=!0,e.innerHTML=`üí° Dica (${o.dicasRestantes})`;const a=document.querySelector(".card-quiz.ativo .texto-dica-placeholder");a&&(a.innerHTML=`<div class="box-dica-texto">${r}</div>`)}function k(){o.animandoTroca||(o.animandoTroca=!0,o.indiceAtual++,o.indiceAtual>=o.perguntas.length?o.modoJogo==="treino"?N():B():S(o.perguntas[o.indiceAtual],!0))}function j(){const e=document.getElementById("input-nome-jogador");if(!e)return;const r=e.value.trim();if(r.length<3){alert("Por favor, digite um nome com pelo menos 3 letras.");return}console.log(`Salvando pontua√ß√£o: ${r} - ${o.pontuacaoTotal}pts`);const a=document.getElementById("btn-salvar-final");a&&(a.innerHTML="‚úÖ Salvo!",a.disabled=!0,e.disabled=!0),alert(`Pontua√ß√£o de ${r} salva com sucesso!`)}function q(e){t.stage&&(t.stage.innerHTML=`
        <div class="card-quiz ativo anime-entrada" style="text-align:center; border: 2px solid var(--error);">
            <h2 style="font-size:3rem;">‚ò†Ô∏è</h2>
            <h3 style="color:var(--error);">${e}</h3>
            <p>Fim de jogo.</p>
            <p>Pontua√ß√£o Final: <strong>${o.pontuacaoTotal}</strong></p>
            <button onclick="location.reload()" style="background:var(--error); color:white; padding:15px; border-radius:12px; border:none; width:100%; font-weight:bold; cursor:pointer; margin-top:20px;">Tentar Novamente</button>
            <br><br>
            <a href="index.html" style="color:#666; text-decoration:none;">Voltar ao Menu</a>
        </div>`),y()}function N(){t.stage&&(t.stage.innerHTML=`
        <div class="card-quiz ativo anime-entrada" style="text-align:center;">
          <h2 style="color:#4f46e5;">‚úÖ Treino Conclu√≠do!</h2>
          <p style="margin:20px 0;">Voc√™ revisou todas as cartas pendentes.</p>
          <a href="index.html"><button style="background:#4f46e5; color:white; padding:15px; width:100%; border:none; border-radius:12px; font-weight:bold; cursor:pointer;">Voltar ao Menu</button></a>
        </div>`),y()}function B(){const r=o.acertos/o.perguntas.length>=.5;y(),t.stage&&(t.stage.innerHTML=`
        <div class="card-quiz ativo anime-entrada" style="text-align:center;">
            <h2>${r?"Parab√©ns!":"Que pena!"}</h2>
            <div style="font-size: 3.5rem; color: ${r?"var(--brand-green)":"var(--error)"}; font-weight:800; margin: 15px 0;">
                ${o.pontuacaoTotal} <span style="font-size:1.5rem">pts</span>
            </div>
            <p style="font-weight:600;">Voc√™ acertou ${o.acertos} de ${o.perguntas.length} quest√µes</p>
            
            <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
            
            <h3>Salvar no Ranking</h3>
            <p style="font-size:0.8rem; color:#666;">Apenas letras (acentos permitidos)</p>
            
            <input type="text" id="input-nome-jogador" maxlength="10" placeholder="seu nome" 
                   style="width: 80%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 10px; text-transform: lowercase; text-align: center;" 
                   oninput="this.value = this.value.toLowerCase().replace(/[^a-z√†-√∫√ß]/g, '')">
            
            <button id="btn-salvar-final" onclick="window.enviarPontuacao()" 
                    style="background:#2563eb; color:white; padding:15px; width:100%; border:none; border-radius:12px; font-weight:bold; cursor:pointer; font-size:1.1rem; margin-top:10px;">
                    üíæ Salvar Conquista
            </button>
            
            <button onclick="location.reload()" style="background:transparent; border:1px solid #ccc; padding:10px; width:100%; margin-top:10px; border-radius:12px; cursor:pointer;">
                Voltar ao Menu
            </button>
        </div>`),r&&F()}function y(){t.tempo&&(t.tempo.style.display="none"),t.contador&&(t.contador.style.display="none"),t.progresso&&(t.progresso.style.display="none")}function F(){if(!t.confete)return;const e=t.confete.getContext("2d");t.confete.width=window.innerWidth,t.confete.height=window.innerHeight;const r=Array.from({length:120},()=>({x:Math.random()*t.confete.width,y:-20,c:["#ff0","#0f0","#00f","#f0f","#0ff","#fff"][Math.floor(Math.random()*6)],s:2+Math.random()*3}));function a(){e.clearRect(0,0,t.confete.width,t.confete.height),r.forEach(n=>{e.fillStyle=n.c,e.fillRect(n.x,n.y+=n.s,5,5),n.y>t.confete.height&&(n.y=-20)}),t.confete.width>0&&requestAnimationFrame(a)}a(),setTimeout(()=>{t.confete.width=0},5e3)}I();
