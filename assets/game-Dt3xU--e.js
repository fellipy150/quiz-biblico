import{extrairPerguntasMass as T,embaralhar as v,parseMarkdownQuiz as $}from"./engine-8kIu10yX.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function a(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(t){if(t.ep)return;t.ep=!0;const n=a(t);fetch(t.href,n)}})();const G="modulepreload",z=function(e){return"/quiz-biblico/"+e},y={},L=function(o,a,s){let t=Promise.resolve();if(a&&a.length>0){let p=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),l=c?.nonce||c?.getAttribute("nonce");t=p(a.map(d=>{if(d=z(d),d in y)return;y[d]=!0;const u=d.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${f}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":G,u||(g.as="script"),g.crossOrigin="",g.href=d,l&&g.setAttribute("nonce",l),document.head.appendChild(g),u)return new Promise((E,b)=>{g.addEventListener("load",E),g.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${d}`)))})}))}function n(c){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=c,window.dispatchEvent(l),!l.defaultPrevented)throw c}return t.then(c=>{for(const l of c||[])l.status==="rejected"&&n(l.reason);return o().catch(n)})},w="quizSRSData";function M(){const e=localStorage.getItem(w);return e?JSON.parse(e):{}}function R(e){localStorage.setItem(w,JSON.stringify(e))}function S(){confirm("Tem certeza? Isso apagar√° todo o hist√≥rico de aprendizado do Modo Treino.")&&(localStorage.removeItem(w),alert("Mem√≥ria limpa! O algoritmo recome√ßar√° do zero."),location.reload())}function P(e,o,a){const s=M();let t=s[e]||{interval:0,ef:2.5,reps:0},n=0;o?a<10?n=5:a<20?n=4:a<30?n=3:n=2:n=0;let c=t.ef+(.1-(5-n)*(.08+(5-n)*.02));c<1.3&&(c=1.3);let l=1,p=t.reps;n<3?(p=0,l=1):(p++,p===1?l=1:p===2?l=6:l=Math.round(t.interval*c)),s[e]={lastReviewed:Date.now(),interval:l,ef:parseFloat(c.toFixed(2)),reps:p},R(s)}console.log("üöÄ [GAME] 1. Arquivo game.js come√ßou a ser lido.");try{var J=await L(()=>import("./engine-8kIu10yX.js"),[])}catch(e){console.error("‚ùå [GAME] CR√çTICO: Falha ao importar depend√™ncias ou sintaxe inv√°lida!",e)}console.log("‚úÖ [GAME] 2. Imports conclu√≠dos com sucesso.");const h=e=>{try{return`/quiz-biblico//${e}`.replace(/\/+/g,"/")}catch(o){return console.error("‚ùå [GAME] Erro ao gerar caminho do asset:",o),e}},m=e=>{const o=document.getElementById(e);return o||console.warn(`‚ö†Ô∏è [GAME] Elemento DOM n√£o encontrado: #${e}`),o},r={lista:m("lista-quizes"),stage:m("quiz-stage"),progresso:m("barra-progresso-container"),titulo:m("titulo-quiz"),descricao:m("descricao-quiz"),tempo:m("display-tempo"),contador:m("contador-perguntas"),selecao:m("tela-selecao"),confete:m("canvas-confete")},i={perguntas:[],indiceAtual:0,acertos:0,pontuacaoTotal:0,modoJogo:null,respondido:!1,dicasRestantes:2,tempoTotal:30,tempoRestante:30,timerInterval:null,srsStartTime:0};console.log("üîÑ [GAME] 3. Tentando expor fun√ß√µes para o window...");try{window.iniciarJogo=function(e){console.log(`üñ±Ô∏è [CLICK] iniciarJogo chamado. Modo: ${e}`),A(e)},window.iniciarModoTreino=function(){console.log("üñ±Ô∏è [CLICK] iniciarModoTreino chamado."),D()},window.verificarResposta=function(e,o){C(e,o)},window.mostrarDica=function(e,o){console.log("üñ±Ô∏è [CLICK] mostrarDica chamado."),j(e,o)},window.transicaoProximaPergunta=function(){console.log("üñ±Ô∏è [CLICK] transicaoProximaPergunta chamado."),F()},window.resetarMemoriaSRS=S,console.log("‚úÖ [GAME] 4. Fun√ß√µes globais registradas com sucesso! (window.iniciarJogo existe)")}catch(e){console.error("‚ùå [GAME] CR√çTICO: Erro ao expor fun√ß√µes no window:",e)}function I(){console.log("üöÄ [GAME] 5. Executando init()...");try{q(),O()}catch(e){console.error("‚ùå [GAME] Erro dentro de init():",e)}}function q(){if(!r.lista){console.warn("‚ö†Ô∏è [GAME] Abortando carregarListaQuizes: Elemento lista n√£o existe.");return}const e=h("quizes/index.json");console.log(`üì° [GAME] Fetching lista de quizes: ${e}`),fetch(e).then(o=>{if(!o.ok)throw new Error(`Status ${o.status}`);return o.json()}).then(o=>{console.log("‚úÖ [GAME] Lista de quizes carregada:",o),r.lista.innerHTML=o.map(a=>`<li><a href="quiz.html?id=${a.arquivo}">${a.titulo}</a></li>`).join("")}).catch(o=>{console.error("‚ùå [GAME] Falha no fetch da lista:",o),r.lista.innerHTML='<p style="text-align:center;">Erro ao carregar lista (ver console).</p>'})}function O(){try{if(!r.stage)return;const o=new URLSearchParams(window.location.search).get("id");if(o){console.log(`üîç [GAME] ID detectado na URL: ${o}`);const a=h(`quizes/${o}.md`);fetch(a).then(s=>{if(!s.ok)throw new Error(`Quiz 404: ${a}`);return s.text()}).then(s=>{console.log("‚úÖ [GAME] Markdown baixado. Iniciando parse...");const t=$(s);if(!t||!t.perguntas||t.perguntas.length===0)throw new Error("Parser retornou 0 perguntas.");r.titulo&&(r.titulo.innerText=t.titulo||"Quiz"),r.descricao&&t.descricao&&(r.descricao.innerHTML=t.descricao,r.descricao.style.display="block"),i.perguntas=t.perguntas,console.log(`‚úÖ [GAME] ${i.perguntas.length} perguntas carregadas no State.`),r.selecao&&(r.selecao.style.display="flex"),r.stage&&(r.stage.style.display="none")}).catch(s=>{console.error("‚ùå [GAME] Erro ao carregar/parsear Quiz:",s),r.titulo&&(r.titulo.innerText="Erro ao carregar"),r.stage.innerHTML=`<p style="text-align:center; color:red">Erro: ${s.message}</p>`,r.stage.style.display="block"})}}catch(e){console.error("‚ùå [GAME] Erro fatal em verificarParametrosURL:",e)}}async function D(){console.log("üèãÔ∏è [GAME] Iniciando l√≥gica Modo Treino..."),r.titulo&&(r.titulo.innerText="Carregando Mem√≥ria..."),r.lista&&(r.lista.style.display="none"),r.selecao&&(r.selecao.style.display="none");try{const e=h("quizes/index.json"),a=await(await fetch(e)).json();let s=[];console.log(`üì¶ [GAME] Baixando ${a.length} arquivos para o treino...`);const t=a.map(async u=>{const f=h(`quizes/${u.arquivo}.md?t=${Date.now()}`),g=await fetch(f);if(!g.ok)return console.warn(`‚ö†Ô∏è [GAME] Falha ao baixar ${u.arquivo} para treino.`),[];const E=await g.text();return T(E,u.arquivo)});(await Promise.all(t)).forEach(u=>s.push(...u)),console.log(`üìö [GAME] Total de quest√µes parseadas: ${s.length}`);const c=M(),l=Date.now(),p=864e5,d=s.filter(u=>{const f=c[u.id];return f?l>=f.lastReviewed+f.interval*p:!0});if(console.log(`üìÖ [GAME] Quest√µes pendentes (Due): ${d.length}`),d.length===0){alert("üéâ Tudo em dia! Volte amanh√£."),location.reload();return}i.perguntas=v(d).slice(0,50),A("treino")}catch(e){console.error("‚ùå [GAME] ERRO FATAL NO MODO TREINO:",e),alert("Erro ao iniciar treino. Veja o console."),location.reload()}}function A(e){try{if(console.log(`üéÆ [GAME] Configurando jogo para modo: ${e}`),i.modoJogo=e,i.indiceAtual=0,i.acertos=0,i.pontuacaoTotal=0,window.pontuacaoTotal=0,window.modoJogo=e,r.selecao&&(r.selecao.style.display="none"),r.stage&&(r.stage.style.display="grid"),r.titulo&&(r.titulo.style.display="block"),i.perguntas.length===0)throw new Error("Array de perguntas est√° vazio ao tentar iniciar jogo.");x(i.perguntas[0],!1)}catch(o){console.error("‚ùå [GAME] Erro em iniciarJogoInternal:",o),alert("Erro ao iniciar a partida.")}}function x(e,o){try{if(!e)throw new Error("Objeto pergunta inv√°lido/undefined");i.respondido=!1,i.srsStartTime=Date.now(),r.contador&&(r.contador.innerText=`${i.indiceAtual+1} / ${i.perguntas.length}`);const a=v([...e.opcoes]),s=document.createElement("div");if(s.className="card-quiz ativo",s.innerHTML=`
            <div class="pergunta">${e.enunciado}</div>
            <div class="lista-opcoes">
            ${a.map((t,n)=>`
                <div class="opcao" data-is-correct="${t.correta}" onclick="window.verificarResposta(${n}, this)">
                ${t.texto}
                </div>
            `).join("")}
            </div>
            <div class="area-dica-container">
                ${e.dica?`<button class="btn-dica-minimal" onclick="window.mostrarDica(this, '${e.dica.replace(/'/g,"\\'")}')">üí° Dica</button>`:""}
                <div class="texto-dica-placeholder"></div>
            </div>
            <button id="btn-prox" style="display:none; margin-top:15px; padding:10px; width:100%;" onclick="window.transicaoProximaPergunta()">Pr√≥xima ‚ûú</button>
        `,!r.stage)throw new Error("Stage element missing");r.stage.innerHTML="",r.stage.appendChild(s),modo!=="treino"&&void 0}catch(a){console.error("‚ùå [GAME] Erro ao renderizar pergunta:",a)}}function C(e,o){try{if(i.respondido)return;i.respondido=!0;const a=o&&o.getAttribute("data-is-correct")==="true";console.log(`üìù [GAME] Resposta: ${a?"ACERTOU":"ERROU"}`),a?(o.classList.add("correta"),i.acertos++,i.pontuacaoTotal+=10,window.pontuacaoTotal=i.pontuacaoTotal):o&&o.classList.add("errada");const s=document.getElementById("btn-prox");if(s&&(s.style.display="block"),i.modoJogo==="treino"){const t=(Date.now()-i.srsStartTime)/1e3,n=i.perguntas[i.indiceAtual];P(n.id,a,t)}}catch(a){console.error("‚ùå [GAME] Erro em verificarResposta:",a)}}function j(e,o){try{e.disabled=!0;const a=document.querySelector(".card-quiz.ativo .texto-dica-placeholder");a&&(a.innerHTML=`<div class="box-dica-texto">${o}</div>`)}catch(a){console.error("Erro na dica:",a)}}function F(){try{i.indiceAtual++,i.indiceAtual>=i.perguntas.length?(console.log("üèÅ [GAME] Fim do Quiz."),r.stage.innerHTML=`
                <div class="card-quiz ativo" style="text-align:center;">
                    <h2>Fim!</h2>
                    <h1>${i.pontuacaoTotal} pts</h1>
                    <button onclick="location.reload()">Menu</button>
                </div>
            `):x(i.perguntas[i.indiceAtual],!0)}catch(e){console.error("‚ùå [GAME] Erro na transi√ß√£o:",e)}}I();
