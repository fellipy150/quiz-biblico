(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function a(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=a(i);fetch(i.href,s)}})();function y(e){try{if(!Array.isArray(e))throw new Error("O par√¢metro fornecido n√£o √© um array.");const r=[...e];for(let a=r.length-1;a>0;a--){const n=Math.floor(Math.random()*(a+1));[r[a],r[n]]=[r[n],r[a]]}return r}catch(r){return console.error("Erro ao embaralhar array:",r),e}}function M(e){try{return e?e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br>"):""}catch(r){return console.error("Erro ao converter Markdown Simples:",r),e||""}}function b(e,r){try{e.opcoes.filter(n=>n.correta).length>=1?r.push(e):console.warn(`Pergunta ID: ${e.id} descartada: Nenhuma op√ß√£o correta definida.`)}catch(a){console.error("Erro na valida√ß√£o da pergunta:",a,e)}}function x(e){try{if(typeof e!="string")throw new Error("A entrada do quiz deve ser uma string Markdown.");const r=e.replace(/\r\n/g,`
`).split(`
`);let a={titulo:"",descricao:"",perguntas:[]},n="",i=!1,s="Geral",d=null,l=null;return r.forEach((u,f)=>{try{const c=u.trim();if(c.startsWith("```md")){i=!0;return}if(c.startsWith("```")&&i){i=!1;return}if(i){n+=u+`
`;return}if(!c)return;if(c.startsWith("# ")){a.titulo=c.replace("# ","").trim();return}if(c.startsWith("## "))return;const g=c.match(/^__(.*?)__$/);if(g&&g[1]!==void 0){s=g[1].trim();return}if(c.startsWith("id:")){d&&b(d,a.perguntas),d={id:c.replace("id:","").trim(),categoria:s,enunciado:"",opcoes:[],dica:null};return}if(c.startsWith("### ")){d&&(d.enunciado=c.replace("### ","").trim());return}if(c.startsWith("[ ]")||c.startsWith("[x]")){if(d){const z=c.startsWith("[x]");l={texto:c.replace(/\[(x| )\]/,"").trim(),correta:z,explicacao:null},d.opcoes.push(l)}return}if((c.startsWith("-!")||c.startsWith("-["))&&l){l.explicacao=c.replace(/^(-!|-\[|\])/g,"").trim();return}if(c.startsWith("-#")&&d){d.dica=c.replace("-#","").trim();return}}catch(c){console.error(`Erro ao processar a linha ${f+1}: "${u}"`,c)}}),d&&b(d,a.perguntas),a.descricao=M(n),a}catch(r){return console.error("Falha cr√≠tica no parseMarkdownQuiz:",r),{titulo:"Erro no carregamento",descricao:"",perguntas:[]}}}function L(e,r){try{const a=x(e);return!a||!a.perguntas?[]:a.perguntas.map(n=>({...n,id:`${r.replace(".md","")}-${n.id}`}))}catch(a){return console.error(`Erro em extrairPerguntasMass (Arquivo: ${r}):`,a),[]}}const v="quizSRSData";function E(){try{const e=localStorage.getItem(v);return e?JSON.parse(e):{}}catch(e){return console.error("Erro ao ler SRS do LocalStorage (Dados corrompidos?):",e),{}}}function R(e){try{const r=JSON.stringify(e);localStorage.setItem(v,r)}catch(r){console.error("Erro ao salvar SRS no LocalStorage:",r),r.name==="QuotaExceededError"&&console.warn("Aviso: LocalStorage est√° cheio. O progresso pode n√£o ser salvo.")}}function A(){try{confirm("Tem certeza? Isso apagar√° todo o hist√≥rico de aprendizado do Modo Treino.")&&(localStorage.removeItem(v),alert("Mem√≥ria limpa! O algoritmo recome√ßar√° do zero."),location.reload())}catch(e){console.error("Erro ao resetar mem√≥ria SRS:",e),alert("N√£o foi poss√≠vel limpar os dados. Tente limpar o cache do navegador.")}}function I(e,r,a){try{if(!e)throw new Error("ID da quest√£o n√£o fornecido.");const n=E();let i=n[e]||{lastReviewed:0,interval:0,ef:2.5,reps:0},s=0;r?a<10?s=5:a<20?s=4:a<30?s=3:s=2:s=0;let d=i.ef+(.1-(5-s)*(.08+(5-s)*.02));d<1.3&&(d=1.3);let l=1,u=i.reps;s<3?(u=0,l=1):(u++,u===1?l=1:u===2?l=6:l=Math.round(i.interval*d)),n[e]={lastReviewed:Date.now(),interval:l,ef:parseFloat(d.toFixed(2)),reps:u},R(n)}catch(n){console.error(`Erro cr√≠tico ao processar algoritmo SRS para ID ${e}:`,n)}}const h=e=>{try{return`/quiz-biblico//${e}`.replace(/\/+/g,"/")}catch(r){return console.error("Erro ao resolver caminho de assets:",r),e}},p=e=>{try{return document.getElementById(e)}catch(r){return console.error(`Erro ao buscar elemento DOM #${e}:`,r),null}},o={lista:p("lista-quizes"),stage:p("quiz-stage"),progresso:p("barra-progresso-container"),titulo:p("titulo-quiz"),descricao:p("descricao-quiz"),tempo:p("display-tempo"),contador:p("contador-perguntas"),selecao:p("tela-selecao"),confete:p("canvas-confete")},t={perguntas:[],indiceAtual:0,acertos:0,pontuacaoTotal:0,modoJogo:null,respondido:!1,dicasRestantes:2,tempoTotal:30,tempoRestante:30,timerInterval:null,srsStartTime:0,animandoTroca:!1},m=(e,r)=>(...a)=>{try{return e(...a)}catch(n){console.error(`Erro fatal na fun√ß√£o global ${r}:`,n)}};window.iniciarJogo=m(e=>T(e),"iniciarJogo");window.iniciarModoTreino=m(()=>H(),"iniciarModoTreino");window.verificarResposta=m((e,r)=>q(e,r),"verificarResposta");window.mostrarDica=m((e,r)=>j(e,r),"mostrarDica");window.transicaoProximaPergunta=m(()=>k(),"transicaoProximaPergunta");window.resetarMemoriaSRS=m(A,"resetarMemoriaSRS");window.enviarPontuacao=m(F,"enviarPontuacao");function P(){try{D(),J()}catch(e){console.error("Erro na inicializa√ß√£o (init):",e)}}function D(){try{if(!o.lista)return;fetch(h("quizes/index.json")).then(e=>e.ok?e.json():[]).then(e=>{try{e.length&&(o.lista.innerHTML=e.map(r=>`<li><a href="quiz.html?id=${r.arquivo}">${r.titulo}</a></li>`).join(""))}catch(r){console.error("Erro ao renderizar lista de quizes:",r)}}).catch(e=>console.error("Erro no fetch da lista de quizes:",e))}catch(e){console.error("Erro cr√≠tico em carregarListaQuizes:",e)}}function J(){try{if(!o.stage)return;const r=new URLSearchParams(window.location.search).get("id");r&&fetch(h(`quizes/${r}.md`)).then(a=>{if(!a.ok)throw new Error("Quiz n√£o encontrado");return a.text()}).then(a=>{try{const n=x(a);o.titulo&&(o.titulo.innerText=n.titulo||"Quiz"),o.descricao&&n.descricao&&(o.descricao.innerHTML=n.descricao,o.descricao.style.display="block"),t.perguntas=n.perguntas,o.selecao&&(o.selecao.style.display="flex"),o.stage&&(o.stage.style.display="none")}catch(n){console.error("Erro ao processar dados do quiz:",n)}}).catch(a=>{console.error("Erro ao carregar arquivo do quiz:",a),o.titulo&&(o.titulo.innerText="Erro ao carregar"),o.stage.innerHTML='<div class="card-quiz error">Erro ao carregar quiz. Verifique a URL e o formato do arquivo.</div>',o.stage.style.display="block"})}catch(e){console.error("Erro geral em verificarParametrosURL:",e)}}async function H(){try{o.titulo&&(o.titulo.innerText="Carregando Mem√≥ria..."),o.lista&&(o.lista.style.display="none"),o.selecao&&(o.selecao.style.display="none");const r=await(await fetch(h("quizes/index.json"))).json();let a=[];const n=r.map(async f=>{try{const c=await fetch(h(`quizes/${f.arquivo}.md?t=${Date.now()}`));if(!c.ok)return[];const g=await c.text();return L(g,f.arquivo)}catch(c){return console.error(`Erro ao carregar quiz ${f.arquivo}:`,c),[]}});(await Promise.all(n)).forEach(f=>a.push(...f));const s=E(),d=Date.now(),l=864e5,u=a.filter(f=>{try{const c=s[f.id];return c?d>=c.lastReviewed+c.interval*l:!0}catch(c){return console.error("Erro ao filtrar quest√£o SRS:",c),!1}});if(u.length===0){alert("üéâ Tudo em dia! Voc√™ revisou todo o conte√∫do pendente."),window.location.href="index.html";return}t.perguntas=y(u).slice(0,50),o.titulo&&(o.titulo.innerText=`üß† Treino do Dia (${t.perguntas.length})`),T("treino")}catch(e){console.error("Erro fatal ao iniciar treino:",e),alert("Erro ao iniciar treino."),location.reload()}}function T(e){try{t.modoJogo=e,t.indiceAtual=0,t.acertos=0,t.pontuacaoTotal=0,t.dicasRestantes=2,t.tempoTotal=e==="desafio"?15:30,t.animandoTroca=!1,window.pontuacaoTotal=0,window.modoJogo=e,document.body&&(e==="desafio"?document.body.classList.add("modo-desafio"):document.body.classList.remove("modo-desafio")),o.selecao&&(o.selecao.style.display="none"),o.descricao&&(o.descricao.style.display="none"),o.titulo&&(o.titulo.style.display="block"),o.stage&&(o.stage.style.display="grid"),e!=="treino"?(o.progresso&&(o.progresso.style.display="flex"),o.tempo&&(o.tempo.style.display="block"),o.contador&&(o.contador.style.display="block"),O()):(o.progresso&&(o.progresso.style.display="none"),o.tempo&&(o.tempo.style.display="none"),o.contador&&(o.contador.style.display="none"));try{t.perguntas&&t.perguntas.length>0?(t.perguntas=y([...t.perguntas]),S(t.perguntas[0],!1)):alert("Nenhuma pergunta encontrada.")}catch(r){console.error("Erro ao embaralhar ou iniciar perguntas:",r)}}catch(r){console.error("Erro fatal em iniciarJogoInternal:",r)}}function O(){try{if(!o.progresso)return;o.progresso.innerHTML="",t.modoJogo==="desafio"?o.progresso.innerHTML='<div class="segmento-barra" id="seg-unico" style="flex: 1;"><div class="fill-tempo"></div></div>':o.progresso.innerHTML=t.perguntas.map((e,r)=>`<div class="segmento-barra" id="seg-${r}"><div class="fill-tempo"></div></div>`).join("")}catch(e){console.error("Erro ao renderizar barra de progresso:",e)}}function S(e,r=!0){try{if(!e)throw new Error("Objeto de pergunta inv√°lido/nulo");t.respondido=!1,t.srsStartTime=Date.now(),t.animandoTroca=!1,o.contador&&(o.contador.innerText=`${t.indiceAtual+1} / ${t.perguntas.length}`);const a=y([...e.opcoes]),n=document.createElement("div");if(n.className="card-quiz",n.innerHTML=`
      <div style="font-size:0.65rem; text-transform:uppercase; opacity:0.5; margin-bottom:4px; font-weight:800; letter-spacing:1px; text-align:center;">
          ${e.categoria||"Geral"}
      </div>
      <div class="pergunta">${e.enunciado||"Enunciado indispon√≠vel"}</div>
      <div class="lista-opcoes">
          ${a.map((i,s)=>`
              <div class="opcao-wrapper">
                  <div class="opcao" data-is-correct="${i.correta}" onclick="window.verificarResposta(${s}, this)">
                      ${i.texto}
                  </div>
              </div>`).join("")}
      </div>
      <div class="area-dica-container">
          ${e.dica?`<button class="btn-dica-minimal" onclick="window.mostrarDica(this, '${(e.dica||"").replace(/'/g,"\\'")}')">üí° Dica</button>`:""}
          <div class="texto-dica-placeholder"></div>
      </div>
      <button id="btn-prox" style="display:none; margin-top:15px; width:100%; padding:12px;" onclick="window.transicaoProximaPergunta()">Pr√≥xima Quest√£o ‚ûú</button>
    `,r&&o.stage){n.classList.add("pre-render-direita");const i=o.stage.querySelector(".card-quiz.ativo");o.stage.appendChild(n),i&&(i.classList.replace("ativo","saindo-esquerda"),setTimeout(()=>{try{i&&i.remove()}catch(s){console.error("Erro ao remover card antigo:",s)}},500)),requestAnimationFrame(()=>{n.classList.replace("pre-render-direita","ativo")})}else n.classList.add("ativo"),o.stage&&(o.stage.innerHTML="",o.stage.appendChild(n));t.modoJogo!=="treino"&&(W(),C())}catch(a){console.error("Erro ao adicionar nova pergunta:",a,e)}}function C(){try{const e=t.modoJogo==="desafio"?"seg-unico":`seg-${t.indiceAtual}`,r=document.getElementById(e);if(!r)return;r.classList.remove("correto","errado");const a=r.querySelector(".fill-tempo");if(!a)return;a.style.transition="none",a.style.width="0%",a.offsetWidth,a.style.transition=`width ${t.tempoTotal}s linear`,a.style.width="100%"}catch(e){console.error("Erro na anima√ß√£o da barra:",e)}}function W(){try{if(!o.tempo)return;t.tempoRestante=t.tempoTotal,clearInterval(t.timerInterval),o.tempo.innerText=`‚è±Ô∏è ${t.tempoRestante}s`,t.timerInterval=setInterval(()=>{try{t.tempoRestante--,o.tempo&&(o.tempo.innerText=`‚è±Ô∏è ${t.tempoRestante}s`),t.tempoRestante<=0&&(clearInterval(t.timerInterval),t.modoJogo==="desafio"?$("Tempo Esgotado!"):q(-1,null))}catch(e){console.error("Erro dentro do intervalo do timer:",e),clearInterval(t.timerInterval)}},1e3)}catch(e){console.error("Erro ao iniciar timer:",e)}}function q(e,r){try{if(t.respondido)return;const a=(Date.now()-t.srsStartTime)/1e3;if(t.respondido=!0,clearInterval(t.timerInterval),t.modoJogo!=="treino")try{const l=t.modoJogo==="desafio"?"seg-unico":`seg-${t.indiceAtual}`,u=document.getElementById(l);if(u){const f=u.querySelector(".fill-tempo");f&&(f.style.width=window.getComputedStyle(f).width,f.style.transition="none")}}catch(l){console.error("Erro ao congelar barra de tempo:",l)}const n=document.querySelector(".card-quiz.ativo");if(!n)return;const i=n.querySelectorAll(".opcao");let s=!1;if(i.forEach(l=>{try{l.classList.add("bloqueado"),l.getAttribute("data-is-correct")==="true"?(l.classList.add("correta"),l===r&&(s=!0)):l===r&&l.classList.add("errada")}catch(u){console.error("Erro ao processar estilo das op√ß√µes:",u)}}),t.modoJogo==="treino"){const l=t.perguntas[t.indiceAtual];I(l.id,s,a)}else{if(s){t.acertos++;let l=t.modoJogo==="desafio"?15:10;t.pontuacaoTotal+=l+Math.round(l*(t.tempoRestante/t.tempoTotal))}if(window.pontuacaoTotal=t.pontuacaoTotal,t.modoJogo==="normal"){const l=document.getElementById(`seg-${t.indiceAtual}`);l&&l.classList.add(s?"correto":"errado")}if(t.modoJogo==="desafio"&&!s){setTimeout(()=>$("Voc√™ Errou!"),1e3);return}}const d=n.querySelector("#btn-prox");d&&(d.style.display="block")}catch(a){console.error("Erro ao verificar resposta:",a)}}function j(e,r){try{if(t.dicasRestantes<=0)return;t.dicasRestantes--,e.disabled=!0,e.innerHTML=`üí° Dica (${t.dicasRestantes})`;const a=document.querySelector(".card-quiz.ativo .texto-dica-placeholder");a&&(a.innerHTML=`<div class="box-dica-texto">${r}</div>`)}catch(a){console.error("Erro ao mostrar dica:",a)}}function k(){try{if(t.animandoTroca)return;t.animandoTroca=!0,t.indiceAtual++,t.indiceAtual>=t.perguntas.length?t.modoJogo==="treino"?N():Q():S(t.perguntas[t.indiceAtual],!0)}catch(e){console.error("Erro na transi√ß√£o de pergunta:",e)}}function F(){try{const e=document.getElementById("input-nome-jogador");if(!e)return;const r=e.value.trim();if(r.length<3){alert("Por favor, digite um nome com pelo menos 3 letras.");return}console.log(`Salvando pontua√ß√£o: ${r} - ${t.pontuacaoTotal}pts`);const a=document.getElementById("btn-salvar-final");a&&(a.innerHTML="‚úÖ Salvo!",a.disabled=!0,e.disabled=!0),alert(`Pontua√ß√£o de ${r} salva com sucesso!`)}catch(e){console.error("Erro ao enviar pontua√ß√£o:",e),alert("Erro ao salvar pontua√ß√£o. Veja o console.")}}function $(e){try{o.stage&&(o.stage.innerHTML=`
          <div class="card-quiz ativo anime-entrada" style="text-align:center; border: 2px solid var(--error);">
              <h2 style="font-size:3rem;">‚ò†Ô∏è</h2>
              <h3 style="color:var(--error);">${e}</h3>
              <p>Fim de jogo.</p>
              <p>Pontua√ß√£o Final: <strong>${t.pontuacaoTotal}</strong></p>
              <button onclick="location.reload()" style="background:var(--error); color:white; padding:15px; border-radius:12px; border:none; width:100%; font-weight:bold; cursor:pointer; margin-top:20px;">Tentar Novamente</button>
              <br><br>
              <a href="index.html" style="color:#666; text-decoration:none;">Voltar ao Menu</a>
          </div>`),w()}catch(r){console.error("Erro ao exibir Game Over:",r)}}function N(){try{o.stage&&(o.stage.innerHTML=`
          <div class="card-quiz ativo anime-entrada" style="text-align:center;">
            <h2 style="color:#4f46e5;">‚úÖ Treino Conclu√≠do!</h2>
            <p style="margin:20px 0;">Voc√™ revisou todas as cartas pendentes.</p>
            <a href="index.html"><button style="background:#4f46e5; color:white; padding:15px; width:100%; border:none; border-radius:12px; font-weight:bold; cursor:pointer;">Voltar ao Menu</button></a>
          </div>`),w()}catch(e){console.error("Erro ao mostrar fim de treino:",e)}}function Q(){try{const r=t.acertos/t.perguntas.length>=.5;w(),o.stage&&(o.stage.innerHTML=`
          <div class="card-quiz ativo anime-entrada" style="text-align:center;">
              <h2>${r?"Parab√©ns!":"Que pena!"}</h2>
              <div style="font-size: 3.5rem; color: ${r?"var(--brand-green)":"var(--error)"}; font-weight:800; margin: 15px 0;">
                  ${t.pontuacaoTotal} <span style="font-size:1.5rem">pts</span>
              </div>
              <p style="font-weight:600;">Voc√™ acertou ${t.acertos} de ${t.perguntas.length} quest√µes</p>
              
              <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
              
              <h3>Salvar no Ranking</h3>
              <p style="font-size:0.8rem; color:#666;">Apenas letras (acentos permitidos)</p>
              
              <input type="text" id="input-nome-jogador" maxlength="10" placeholder="seu nome" 
                    style="width: 80%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 10px; text-transform: lowercase; text-align: center;" 
                    oninput="this.value = this.value.toLowerCase().replace(/[^a-z√†-√∫√ß]/g, '')">
              
              <button id="btn-salvar-final" onclick="window.enviarPontuacao()" 
                      style="background:#2563eb; color:white; padding:15px; width:100%; border:none; border-radius:12px; font-weight:bold; cursor:pointer; font-size:1.1rem; margin-top:10px;">
                      üíæ Salvar Conquista
              </button>
              
              <button onclick="location.reload()" style="background:transparent; border:1px solid #ccc; padding:10px; width:100%; margin-top:10px; border-radius:12px; cursor:pointer;">
                  Voltar ao Menu
              </button>
          </div>`),r&&B()}catch(e){console.error("Erro ao mostrar resultado final:",e)}}function w(){try{o.tempo&&(o.tempo.style.display="none"),o.contador&&(o.contador.style.display="none"),o.progresso&&(o.progresso.style.display="none")}catch(e){console.error("Erro ao ocultar HUD:",e)}}function B(){try{let e=function(){try{r.clearRect(0,0,o.confete.width,o.confete.height),a.forEach(n=>{r.fillStyle=n.c,r.fillRect(n.x,n.y+=n.s,5,5),n.y>o.confete.height&&(n.y=-20)}),o.confete.width>0&&requestAnimationFrame(e)}catch(n){console.error("Erro no loop de anima√ß√£o de confete:",n)}};if(!o.confete)return;const r=o.confete.getContext("2d");o.confete.width=window.innerWidth,o.confete.height=window.innerHeight;const a=Array.from({length:120},()=>({x:Math.random()*o.confete.width,y:-20,c:["#ff0","#0f0","#00f","#f0f","#0ff","#fff"][Math.floor(Math.random()*6)],s:2+Math.random()*3}));e(),setTimeout(()=>{o.confete.width=0},5e3)}catch(e){console.error("Erro ao iniciar confetes:",e)}}P();
